package common.interceptor;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.springframework.web.servlet.ModelAndView;
import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;

import members.dto.AuthInfo;

public class AuthCheckInterceptor extends HandlerInterceptorAdapter{
	public AuthCheckInterceptor() {
		
	}
	
	@Override       //요청한 실제 컨트롤러가 수행되기 직전에 처리됨
	public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)
			throws Exception {
		//로그인이 되어있는지 확인
		//false 이면 현재 생성된 세션이 없으면 null값을 리턴
		//true 이면  현재 생성된 세션이 없으면 세션을 생성함
		HttpSession session = request.getSession(false);
		
		if(session != null) {
			AuthInfo authInfo = (AuthInfo)session.getAttribute("authInfo");
			if(authInfo != null) {
				return true;
		 	 }
	 		
	 	  }
		 	//로그인이 안되어있으면 로그인 화면으로 가게함
			response.sendRedirect(request.getContextPath() + "/member/login.do");
			return false;
		}
	
	
	@Override    //요청한 컨트롤러가 수행된 후
	public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler,
			ModelAndView modelAndView) throws Exception {
		
		super.postHandle(request, response, handler, modelAndView);
	}
	
	@Override    //컨트롤러가 수행된 후 뷰 페이지가 응답하기 직전
	public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)
			throws Exception {
		
		super.afterCompletion(request, response, handler, ex);
	}

}//end class
